(this["webpackJsonpcsv-loader-map"]=this["webpackJsonpcsv-loader-map"]||[]).push([[0],{62:function(e,t,n){},70:function(e,t){},72:function(e,t){},88:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n(0),i=n.n(o),a=n(23),c=n.n(a),l=(n(62),n(37)),s=n.n(l),u=n(38),d=n(14),p=n(47),m=n(7),f=n(48),b=n(108),g=Object(o.createContext)(),h=function(e){var t=Object(o.useState)({csvValues:void 0,sortedStructures:void 0}),n=Object(m.a)(t,2),i=n[0],a=n[1];return Object(r.jsx)(g.Provider,{value:[i,a],children:e.children})},y=n(64),j=Object(b.a)((function(e){return{viewDiv:{width:"100wh",height:"90vh"},contentDiv:{width:"100wh",height:"90vh",margin:"10px 5px"},layerListDiv:{width:"200px",fontSize:"6px",padding:0}}})),v=function(){var e=j(),t=Object(o.useContext)(g),n=Object(m.a)(t,2),i=n[0],a=n[1],c=i.csvValues,l=function(){var e=Object(p.a)(s.a.mark((function e(t){var n,r,o,c,l,p,b,g,h,j,v,x,O,w,S,k,I,C,P,M,D,L,A,F,T,z,E,N,V,R,q,$,B,G,H,Z,_,J,Q,W,K;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={url:"https://js.arcgis.com/4.18/init.js",css:"https://js.arcgis.com/4.18/esri/themes/light/main.css"},e.next=4,Object(f.loadModules)(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/geometry/Point","esri/geometry/Polyline","esri/Graphic","esri/widgets/LayerList","esri/core/Collection","esri/widgets/Home","dojo/_base/array","dojo/domReady!"],n);case 4:r=e.sent,o=Object(m.a)(r,10),c=o[0],l=o[1],p=o[2],b=o[3],g=o[4],h=o[5],j=o[6],v=o[7],x=o[8],O=o[9],k={},t&&t.length>0?(C=t.filter((function(e){return!!e.order&&e.latitude&&e.longitude})).sort((function(e,t){return e.profile===t.profile?parseInt(e.order)<parseInt(t.order)?-1:1:parseInt(e.profile)<parseInt(t.profile)?-1:1})),a(Object(d.a)(Object(d.a)({},i),{},{sortedStructures:C})),P=t.filter((function(e){return!e.order&&e.latitude&&e.longitude})),M=C.map((function(e){return e.profile})).filter((function(e,t,n){return n.indexOf(e)===t})),D=y({luminosity:"bright",count:M.length,hue:"red"}),L={},M.forEach((function(e,t){L[e]=D[t]})),console.log("Colors: ",L),console.log("Structure Data: ","data length: ",C.length,"sample: ",C[0]),console.log("Other Data: ","data length: ",P.length,"sample: ",P[0]),A=function(e){var t=[];return O.forEach(e,(function(e){var n={};n.id=e.id,e.order&&(n.mark=e.mark,n.profile=e.profile,n.order=e.order,n.structureAngles=e.structureAngles,n.measure=e.measure),n.longitude=e.longitude,n.latitude=e.latitude,n.code=e.code,n.attributes=e.attributes;var r=new b(e.longitude,e.latitude),o=new h({geometry:r,attributes:n});t.push(o)})),t},F=function(e){return function(t){return t.reduce((function(t,n){var r=n[e];return t[r]=(t[r]||[]).concat(n),t}),{})}}("profile"),T=F(C),Object.keys(T).map((function(e){var t={pointsSorted:T[e].sort((function(e,t){return parseInt(e.order)<parseInt(t.order)?-1:1})),pointsCount:T[e].length},n=Math.round(t.pointsSorted[t.pointsCount-1].measure,0);t=Object(d.a)({profileLength:n},t),k[e]=t})),z=function(){var e,t,n=[];Object.keys(k).map((function(r){t=k[r].pointsSorted,e=[],t.map((function(t){return e.push([t.longitude,t.latitude])}));var o=new g({hasZ:!1,hasM:!0,paths:e,spatialReference:{wkid:4326}}),i={};i.objectID=r,i.count=t.length,i.length=t[t.length-1].measure;var a=new h({geometry:o,attributes:i});n.push(a)}));var r={type:"unique-value",field:"objectID",uniqueValueInfos:Object.keys(k).map((function(e){return t=e,L[e],{value:t,label:t,symbol:{type:"cim",data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:3,color:[240,94,35,255]},{type:"CIMVectorMarker",enable:!0,size:10,markerPlacement:{type:"CIMMarkerPlacementAlongLineSameSize",endings:"WithMarkers",placementTemplate:[30],angleToLine:!0},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-8,-5.47],[-8,5.6],[1.96,-.03],[-8,-5.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[240,94,35,255]}]}}]}]}}}};var t}))};return[n,r]},E=function(){var e=z(),t=Object(m.a)(e,2),n=t[0],r=t[1];return new p({source:n,objectIdField:"objectID",fields:[{name:"objectID",type:"oid"},{name:"count",type:"integer"},{name:"length",type:"double"}],popupTemplate:{title:"Profile",content:"Profile {objectID} - {count} structures - {length} m"},renderer:r,title:"Profiles"})},N=function(){var e=A(C);return new p({source:e,objectIdField:"id",fields:[{name:"id",type:"oid"},{name:"profile",type:"string"},{name:"order",type:"string"},{name:"structureAngles",type:"string"},{name:"latitude",type:"double"},{name:"longitude",type:"double"},{name:"measure",type:"double"},{name:"code",type:"string"},{name:"mark",type:"string"},{name:"attributes",type:"string"}],popupTemplate:{title:"Structure Point",expressionInfos:[{name:"measure-roundup",title:"Measure Roundup",expression:"Round($feature.measure, 2)"}],content:"<div><h3>Point {mark}{order} - Profile{profile} - {id} - {code}</h3><ul><li>Measure: {expression/measure-roundup} m</li><li>StructureAngles: {structureAngles}</li><li>Attributes: {attributes}</li></ul></div>"},renderer:{type:"unique-value",field:"profile",uniqueValueInfos:M.map((function(e){return{value:t=e,symbol:{type:"simple-marker",size:8,color:L[t],outline:{width:1.5,color:"white"}},label:t};var t}))},labelingInfo:R,title:"Structure Points"})},V=function(){var e=A(P);return console.log("other points number",e.length),new p({source:e,objectIdField:"id",fields:[{name:"id",type:"oid"},{name:"latitude",type:"double"},{name:"longitude",type:"double"},{name:"code",type:"string"},{name:"attributes",type:"string"}],popupTemplate:{title:"Non-Structure Point",content:"<p>Point <b>{id} ({code})</b></p><ul><li>{attributes}</li><ul>"},renderer:{type:"simple",symbol:{type:"simple-marker",size:5,color:"blue",outline:{width:.5,color:"white"}}},labelingInfo:q,title:"Non-Structure Points"})},R={symbol:{type:"text",color:"red",haloColor:"white",haloSize:"1.5px",font:{size:"18px",family:"Noto Sans",style:"italic",weight:"bolder"}},labelPlacement:"above-right",labelExpressionInfo:{expression:"'P' + $feature.profile + '-' + $feature.mark[0] + '' + $feature.order"},deconflictionStrategy:"static"},q={symbol:{type:"text",color:"blue",haloColor:"white",haloSize:"1px",font:{size:"15px",family:"Noto Sans",style:"italic",weight:"bolder"}},labelPlacement:"above-right",labelExpressionInfo:{expression:"$feature.id + ' - ' + $feature.code"},deconflictionStrategy:"static"},$=function(e){return e.queryExtent().then((function(e){S.goTo(e.extent).catch((function(e){"AbortError"!==e.name&&console.error(e)}))}))},B=N(),G=V(),(I=E()).when((function(){console.log("Zoom to line layer"),$(I)})),w=new c({basemap:"hybrid",layers:[I,G,B]}),S=new l({container:"viewDiv",center:[-168,46],zoom:2,map:w,highlightOptions:{color:[255,255,0,1],haloOpacity:.9,fillOpacity:.4}}),H=new j({view:S,listItemCreatedFunction:function(e){var t=e.item;t.title.includes("Profile")?(t.actionsOpen=!0,t.actionsSections=[["All"].concat(Object(u.a)(Object.keys(k))).map((function(e){var t;return t="All"===e?Object.keys(k).map((function(e){return k[e].profileLength})).reduce((function(e,t){return e+t})):k[e].profileLength,{title:"Profile ".concat(e," - ").concat(t," m"),className:"esri-icon-zoom-out-fixed",id:e}}))]):"Structure Points"===t.title&&(t.actionsOpen=!1,t.actionsSections=[C.map((function(e){return{title:"P".concat(e.profile,"-").concat(e.mark[0]).concat(e.order,"-").concat(e.id,"\n                                    ").concat(e.structureAngles.includes("running")?"-Running":"","\n                                    ").concat(e.structureAngles.includes("tap")?"-Tap":""),className:"esri-icon-zoom-out-fixed",id:"".concat(e.id)}}))])},container:"layerListDiv"}),S.ui.add(H,"top-right"),Z=new v(["All"].concat(Object(u.a)(Object.keys(k))).map((function(e){return{id:e,expression:"objectID = '".concat(e,"'")}}))),_=new v(C.map((function(e){return{id:e.id,expression:"id = '".concat(e.id,"'")}}))),J=I.createQuery(),Q=B.createQuery(),S.whenLayerView(I).then((function(e){var t=I.fullExtent,n=new x({view:S});n.goToOverride=function(){S.goTo({target:t},{duration:2e3,easing:"in-out-expo"}).catch((function(e){"AbortError"!==e.name&&console.log(e)}))},S.ui.add(n,"top-left"),H.on("trigger-action",(function(e){var n,r,o=e.action.id,i=e.item.layer;e.item.title.includes("Profile")?(n=Z.find((function(e){return e.id===o})).expression,r=J):(n=_.find((function(e){return e.id===o})).expression,r=Q),n.includes("All")?S.goTo({target:t},{duration:2e3,easing:"in-out-expo"}).catch((function(e){"AbortError"!==e.name&&console.log(e)})):(r.where=n,i.queryFeatures(r).then((function(e){var t=e.features[0];if(console.log("type",t.geometry.type),"point"===t.geometry.type)S.goTo({target:t.geometry,zoom:20},{duration:2e3,easing:"in-out-expo"}).catch((function(e){"AbortError"!==e.name&&console.log(e)}));else{var n=t.geometry.extent.clone();S.goTo({target:t.geometry,extent:n.expand(1.5)},{duration:2e3,easing:"in-out-expo"}).catch((function(e){"AbortError"!==e.name&&console.log(e)}))}})))}))}))):(w=new c({basemap:"hybrid"}),S=new l({container:"viewDiv",center:[-116,54],zoom:6,map:w,highlightOptions:{color:[255,255,0,1],haloOpacity:.9,fillOpacity:.4}})),(W=document.createElement("div")).id="coordsWidget",W.className="esri-widget esri-component",W.style.padding="7px 15px 5px",S.ui.add(W,"bottom-left"),K=function(e){var t="Lat/Lon "+e.latitude.toFixed(3)+" "+e.longitude.toFixed(3)+" | Scale 1:"+Math.round(1*S.scale)/1+" | Zoom "+S.zoom;W.innerHTML=t},S.watch("stationary",(function(e){K(S.center)})),S.on("pointer-move",(function(e){K(S.toMap({x:e.x,y:e.y}))})),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),console.error(e.t0);case 31:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t){return e.apply(this,arguments)}}();return Object(o.useEffect)((function(){console.log("Map get data: ".concat((new Date).toLocaleTimeString()),c);var e=document.getElementById("layerListDiv");e&&(e.innerHTML=""),l(c)}),[c]),Object(r.jsxs)("div",{id:"contentDiv",className:e.contentDiv,children:[Object(r.jsx)("div",{id:"viewDiv",className:e.viewDiv}),c&&Object(r.jsx)("div",{id:"layerListDiv",className:e.layerListDiv})]})},x=n(49),O=function(){var e=Object(o.useContext)(g),t=Object(m.a)(e,2),n=(t[0],t[1]);return Object(r.jsx)(x.a,{onDrop:function(e){var t=Object.values(e).filter((function(e){return!!e})).map((function(e){var t=e.data;return e.data.order?{id:t.id,code:t.code,mark:t.struc_mark,profile:t.profile,order:t.order,structureAngles:t.struc_angles,longitude:parseFloat(t.longitude),latitude:parseFloat(t.latitude),measure:parseFloat(t.measure),attributes:t.attributes}:{id:t.id,code:t.code,longitude:parseFloat(t.longitude),latitude:parseFloat(t.latitude),attributes:t.attributes}}));n(Object(d.a)(Object(d.a)({},e),{},{csvValues:t}))},onError:function(e,t,n,r){console.log(e)},addRemoveButton:!0,removeButtonColor:"#659cef",onRemoveFile:function(e){},config:{header:!0},children:Object(r.jsx)("span",{children:"Drop CSV file here or click to upload."})})},w=n(53),S=n(5),k=n(112),I=n(115),C=n(116),P=n(110),M=n(113),D=n(114),L=n(111),A=Object(b.a)({table:{},body:{},header:{}}),F=Object(S.a)({root:{color:"black",background:"whitesmoke",fontSize:16}})(C.a),T=Object(S.a)({root:{color:"white",background:"slateblue",fontSize:18}})(C.a);function z(){var e=Object(o.useContext)(g),t=Object(m.a)(e,1)[0].sortedStructures,n=A();return Object(r.jsx)(P.a,{component:L.a,children:Object(r.jsxs)(k.a,{className:n.table,"aria-label":"simple table",children:[Object(r.jsx)(M.a,{className:n.header,children:Object(r.jsxs)(D.a,{children:[Object(r.jsx)(T,{align:"middle",children:"Profile"}),Object(r.jsx)(T,{align:"middle",children:"STR#"}),Object(r.jsx)(T,{align:"middle",children:"Code"}),Object(r.jsx)(T,{align:"middle",children:"Measure\xa0(m)"}),Object(r.jsx)(T,{align:"middle",children:"Angles"})]})}),Object(r.jsx)(I.a,{className:n.body,children:t&&t.map((function(e){return Object(r.jsxs)(D.a,{children:[Object(r.jsx)(F,{component:"th",scope:"row",align:"middle",children:e.profile}),Object(r.jsxs)(F,{align:"middle",children:[e.mark,e.order]}),Object(r.jsx)(F,{align:"middle",children:e.code}),Object(r.jsx)(F,{align:"middle",children:e.measure}),Object(r.jsx)(F,{align:"middle",children:e.structureAngles})]},e.id)}))})]})})}var E=function(){var e=Object(o.useContext)(g),t={display:Object(m.a)(e,1)[0].csvValues?"flex":"none",justifyContent:"center",border:"solid 1px #ddd",background:"darkgray",color:"white",opacity:.8,overflow:"auto"};return Object(r.jsx)(w.a,{style:t,default:{x:30,y:200,width:700,height:350},children:Object(r.jsx)(z,{})})},N=function(){return Object(o.useEffect)((function(){document.title="Fortis CSV Viewer"}),[]),Object(r.jsx)("div",{style:{width:"95%",height:"100%",margin:"auto"},children:Object(r.jsxs)(h,{children:[Object(r.jsx)(O,{}),Object(r.jsx)(v,{}),Object(r.jsx)(E,{})]})})},V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,118)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),r(e),o(e),i(e),a(e)}))};c.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(N,{})}),document.getElementById("root")),V()}},[[88,1,2]]]);
//# sourceMappingURL=main.9ab47d88.chunk.js.map